# 守岸人 (Shorekeeper) - 连招逻辑分析

## 基本信息

| 属性 | 值 |
|------|------|
| 角色名称 | 守岸人 (Shorekeeper) |
| 角色定位 | Healer（治疗） |
| 元素属性 | 衍射 (Spectro) |
| 协奏类型 | 黄圈 (concerto_spectro) |
| 版本 | v1.3 |
| 源文件 | `src/core/combat/resonator/shorekeeper.py` |

## 角色机制

守岸人拥有 **5 格能量条**和**蝴蝶变身**系统：

### 能量系统

- 3 段普攻可积攒 3-4 格能量
- 重击（z）可进入蝴蝶形态（消耗能量）
- E 技能退出蝴蝶并获得额外能量
- 蝴蝶退出后跳+普攻（ja）可清空能量

### 进阶轴核心循环

1. 3 段普攻打到 3-4 格能量
2. 重击进入蝴蝶
3. E 退出蝴蝶（获得 5 格能量）
4. 跳+普攻+声骸清空能量
5. 释放大招

### 蝴蝶问题

守岸人进入蝴蝶后如果不操作会一直飞行，需要注意：
- 多加普攻 `a` 打断蝴蝶飞行
- Boss 击败时需要立即跳跃打断蝴蝶

## 技能状态检测

### 能量检测

| 检测项 | 检测方式 | 说明 |
|--------|----------|------|
| 能量1格 | 黄色像素 `(114,241,255)` | 第1段能量 |
| 能量2格 | 同上 | 第2段能量 |
| 能量3格 | 同上 | 第3段能量 |
| 能量4格 | 同上 | 第4段能量 |
| 能量5格 | 同上 | 第5段（两侧蝴蝶） |

### 技能检测

| 检测项 | 图标颜色 | 说明 |
|--------|----------|------|
| 共鸣技能 E | 白色 `(255,255,255)` | E技能就绪 |
| 声骸技能 Q | 白色 `(255,255,255)` | 声骸就绪 |
| 共鸣解放 R | 白色 `(255,255,255)` | 大招就绪 |

## 连招片段

| 方法 | 描述 | 说明 |
|------|------|------|
| `a2()` | 2段普攻 | 快速2段 |
| `a3()` | 3段普攻 | 3段普攻攒能量 |
| `a3Ea()` | 3普攻+E+普攻 | E后接a防发呆 |
| `zaEja()` | 进阶轴核心 | 重击进蝴蝶→E退出→跳+普攻清能量 |
| `zE()` | 重击+E | 进蝴蝶+E退出 |
| `Eja()` | E+跳+普攻 | E退出+清能量 |
| `ja()` | 跳+普攻 | 清空能量 |
| `za()` | 重击+普攻 | 常规重击+打断防飞 |
| `E()` | E技能 | 仅E |
| `Q()` | 声骸技能 | 声骸释放 |
| `R()` | 共鸣解放 | 大招，等待3.08秒 |

## 连招决策逻辑 (`combo()`)

```
截图检测大招状态

入场: a3() 性价比3段普攻

1. 有R（协星调律）:
   ├─ E()
   ├─ R() (等待3.08秒)
   └─ return

2. 再次截图检测:
   检查能量、E技能、R、Boss血量

3. 能量3格 且 有E 且 Boss未击败:
   ├─ zaEja() 进阶轴核心循环
   ├─ Q()
   └─ return

4. 通用处理:
   ├─ E() (无R时等待合轴)
   ├─ R() (有R时释放)
   ├─ 能量5格 → ja() 清能量
   └─ Q()

异常处理:
└─ StopError → jump() 打断蝴蝶变身防止飞出场外
```

## 设计特点

1. **蝴蝶飞出防护** - `combo()` 使用 try-except 捕获 `StopError`，调用 `jump()` 打断守岸人变身蝴蝶
2. **能量3格触发** - 进阶轴需要精确 3 格能量才执行 zaEja 循环
3. **ja替代za** - 5 格能量时使用 `ja()` 而非 `za()`，防止按键卡掉导致蝴蝶飞出
4. **E后接a** - 多处 E 后接额外普攻，防止 E 没好时原地发呆
5. **大招优先** - 有 R 时优先释放（协星调律回复队友血量）

---

*最后更新: 2026-02-06*
