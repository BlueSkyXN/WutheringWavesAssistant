# 琳奈 (Lynae) - 连招逻辑分析

## 基本信息

| 属性 | 值 |
|------|------|
| 角色名称 | 琳奈 (Lynae) |
| 角色定位 | Support（辅助） |
| 元素属性 | 衍射 (Spectro) |
| 协奏类型 | 黄圈 (concerto_spectro) |
| 版本 | v3.0 |
| 源文件 | `src/core/combat/resonator/lynae.py` |

## 角色机制

琳奈拥有**双阶段**战斗系统：

### 光学取样阶段（常规形态）

- 普攻/重击最多三段
- 打满溢彩能量后，重击蓄力（霸体减伤）可进入轮滑形态
- 满蓄力获得120点满流光

### 绮彩巡游状态（轮滑形态）

- 普攻最多5段
- 强化跳跃消耗40点流光，获得一点本色（最多3点）
- 三点本色可打出强化下落攻击
- 重击可持续自动转圈，消耗体力
- **延奏会退出绮彩巡游，变奏不会**
- E后从普攻第二段开始

## 技能状态检测

### 特殊状态检测

| 检测项 | 逻辑 | 说明 |
|--------|------|------|
| 灵感碰撞 | AND | 溢彩能量满，可进入轮滑（4个检测点白色） |
| 流光满(120) | OR | 流光能量满 |
| 本色1格 | 容差50 | 第1格能量（绿色系） |
| 本色2格 | 容差50 | 第2格能量（黄色系） |
| 本色3格 | 容差50 | 第3格能量（粉色系） |
| 绮彩巡游·普攻 | AND | 轮滑形态的普攻图标 |
| 幻光折跃 | OR | 强化跳跃可用 |
| 虹彩飞溅 | AND | 强化下落攻击青春版 |
| 视觉冲击 | AND | 强化下落攻击 |

### 技能检测

| 检测项 | 逻辑 | 说明 |
|--------|------|------|
| 共鸣技能 E | AND | E技能就绪 |
| 声骸技能 Q | OR | 声骸就绪 |
| 共鸣解放 R | OR | 大招就绪 |

## 连招片段

### 光学取样阶段

| 方法 | 描述 |
|------|------|
| `optical_sampling_stage_a3()` | 3段普攻 |
| `optical_sampling_stage_E2a()` | E+2段普攻 |
| `optical_sampling_stage_z()` | 重击蓄力进入轮滑 |

### 绮彩巡游状态

| 方法 | 描述 |
|------|------|
| `kaleidoscopic_parade_a5()` | 轮滑5段普攻 |
| `kaleidoscopic_parade_E4a()` | 轮滑E+4段普攻 |
| `kaleidoscopic_parade_z()` | 轮滑重击转圈 |
| `kaleidoscopic_parade_j()` | 强化跳跃 |
| `kaleidoscopic_parade_3jza()` | 3跳+重击+普攻 |
| `kaleidoscopic_parade_2jzja()` | 2跳+重击+跳+普攻 |

### 通用

| 方法 | 描述 |
|------|------|
| `a()` | 单段普攻 |
| `a2()` | 2段普攻 |
| `E()` | E技能 |
| `aQ()` | 普攻+声骸 |
| `Q()` | 声骸技能 |
| `R()` | 共鸣解放（等待4.7秒） |

## 连招决策逻辑 (`combo()`)

```
释放声骸 Q()
截图检测所有状态

## 光学取样阶段（非轮滑）
if 不在绮彩巡游:
    if 溢彩能量未满:
        ├─ 有E → optical_sampling_stage_E2a()
        ├─ 无E → optical_sampling_stage_a3()
        └─ 有R → R()
    再次检查溢彩
    if 仍未满 → return
    进入轮滑: optical_sampling_stage_z()

## 绮彩巡游状态
if 在绮彩巡游 或 刚进入轮滑:
    有E → E()
    有R → R()

    本色3格满:
        └─ j() 跳跃 + a() + a() 下砸
        └─ return

    随机: 50% kaleidoscopic_parade_z() / 50% optical_sampling_stage_a3()

    ## 空中攻击流程
    检查流光能量:
    ├─ 流光满 → kaleidoscopic_parade_2jzja() 三跳下砸
    ├─ 无折跃 → return
    ├─ 第一次折跃 j() + z()
    ├─ 检查:
    │   ├─ 流光满或不够 → aQ() 下砸结束
    │   └─ 第二次折跃 j()
    │       ├─ 流光满或不够 → aQ()
    │       └─ 第三次折跃 j() + aQ()

兜底: R() + optical_sampling_stage_a3() + E()
```

## 设计特点

1. **双阶段系统** - 光学取样和绮彩巡游两个完全不同的战斗模式
2. **流光能量管理** - 精确管理流光能量决定跳跃次数
3. **多层状态检测** - 需要检测溢彩、流光、本色等多种能量状态
4. **体力管理** - 重击转圈消耗体力，50%概率选择重击或普攻避免缺体力
5. **能量颜色区分** - 本色3格能量分别为绿色、黄色、粉色，需要不同的颜色检测

---

*最后更新: 2026-02-06*
