# 莫宁 (Mornye) - 连招逻辑分析

## 基本信息

| 属性 | 值 |
|------|------|
| 角色名称 | 莫宁 (Mornye) |
| 角色定位 | Healer（治疗） |
| 元素属性 | 熔融 (Fusion) |
| 协奏类型 | 红圈 (concerto_fusion) |
| 版本 | v3.0 |
| 源文件 | `src/core/combat/resonator/mornye.py` |

## 角色机制

莫宁拥有**双模式**战斗系统：

### 基准模式（常规形态）

- **静质量能** - 能量条，满时可重击进入广域观测模式
- 3段普攻积攒能量
- E技能（期望误差）
- 重击·位势转换：满能量时重击进入蝴蝶形态

### 广域观测模式（蝴蝶形态）

- **相对动能** - 能量条，满时可释放重击·反演
- 普攻和E技能为变身后的强化版
- E技能·分布式阵列
- 重击·反演：消耗相对动能

### 进阶轴核心循环

1. 3段普攻攒4格能量
2. 重击进入蝴蝶
3. E退出蝴蝶（获得5格能量）
4. 跳+普攻清空能量
5. 声骸技能合轴

## 技能状态检测

### 能量检测

| 检测项 | 值 | 说明 |
|--------|------|------|
| 静质量能 20% | 蓝色 `(63,119,250)` | 基准模式能量 |
| 静质量能 50% | 蓝色 | 基准模式能量 |
| 静质量能 80% | 蓝色 | 基准模式能量 |
| 相对动能 20% | 暖色系 | 广域观测模式能量 |
| 相对动能 50% | 暖色系 | 广域观测模式能量 |
| 相对动能 80% | 暖色系 | 广域观测模式能量 |

### 状态检测

| 检测项 | 逻辑 | 说明 |
|--------|------|------|
| 重击·位势转换 | AND | 满能量可变身（4个检测点白色） |
| 广域观测模式 | AND | 是否在蝴蝶形态（4个检测点白色） |
| 共鸣技能·分布式阵列 | AND | 蝴蝶E技能 |
| 重击·反演 | AND | 蝴蝶重击（5个检测点白色） |
| 声骸技能 Q | OR | 声骸就绪 |
| 共鸣解放 R | AND | 大招就绪 |
| 共鸣解放2 | AND | 谐振场内大招 |

## 连招片段

| 方法 | 描述 | 说明 |
|------|------|------|
| `a4()` | 4段普攻 | 入场基础连招 |
| `Eaa()` | E+两段普攻 | E技能后接普攻防发呆 |
| `E()` | E技能 | 仅E |
| `z()` | 重击 | 重击技能 |
| `Q()` | 声骸技能 | 声骸释放 |
| `R()` | 共鸣解放 | 大招，等待3.08秒 |
| `exit_special_state()` | 退出特殊状态 | 声骸搜寻前退出广域观测模式 |

### 未实现的连招片段（规划中）

以下方法在守岸人中已实现，莫宁计划在未来版本中添加：

| 方法 | 描述 | 优先级 |
|------|------|--------|
| `a3()` | 3段普攻 | 高 - 性价比普攻 |
| `a2()` | 2段普攻 | 中 - 快速普攻 |
| `zaEja()` | 进阶轴核心 | 高 - 重击进蝴蝶+E退出+跳+普攻清能量 |
| `ja()` | 跳+普攻 | 高 - 清空能量 |
| `za()` | 重击+普攻 | 中 - 常规重击+打断防飞 |
| `zE()` | 重击+E | 中 - 重击进蝴蝶+E退出 |
| `Eja()` | E+跳+普攻 | 中 - E退出+清能量 |

## 连招决策逻辑 (`combo()`)

⚠️ **当前实现为简化版本**

### 当前实际逻辑

```
1. 入场: a4() - 4段普攻

2. 随机执行以下技能（顺序随机打乱）:
   ├─ Eaa() - E技能 + 两段普攻
   ├─ R() - 大招
   └─ z() - 重击

3. 释放声骸: Q()
```

### 实现特点

- **简化设计**: 不进行状态检测，按固定流程执行
- **随机化**: 使用 `random.shuffle()` 打乱 E、R、z 的执行顺序
- **无条件判断**: 不检测能量、技能就绪状态、Boss血量

### 局限性

当前简化实现存在以下局限：

1. ❌ **无状态检测** - 不截图检测能量、技能状态
2. ❌ **无条件判断** - 不根据战况智能决策
3. ❌ **无异常处理** - 缺少蝴蝶变身打断保护
4. ⚠️ **随机顺序** - 技能执行顺序不固定，可能非最优

### 规划的高级逻辑（未来版本）

未来版本计划实现类似守岸人的高级逻辑：

```
截图检测大招状态

入场: a3() 性价比3段普攻

1. 有R（协星调律）:
   ├─ E()
   ├─ R()
   └─ return

2. 再次截图检测:
   检查静质量能、相对动能、E技能、R、Boss血量

3. 满足进阶轴条件:
   ├─ zaEja() 进阶轴核心循环（重击进蝴蝶 → E退出 → 跳+普攻清能量）
   ├─ Q()
   └─ return

4. 通用处理:
   ├─ E() (无R时等待合轴)
   ├─ R() (有R时释放)
   ├─ 能量满格 → ja() 清能量
   └─ Q()

异常处理:
└─ StopError → jump() 打断蝴蝶变身防止飞出场外
```

## 设计特点

1. **简化实现** - 当前版本优先稳定性，使用简化的连招逻辑
2. **固定流程** - 4段普攻起手，保证基础伤害输出
3. **声骸收尾** - 确保每轮都释放声骸技能
4. **待完善项** - 缺少蝴蝶飞出防护、能量管理、条件判断等高级功能

---

*最后更新: 2026-02-10*
