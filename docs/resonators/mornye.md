# 莫宁 (Mornye) - 连招逻辑分析

## 基本信息

| 属性 | 值 |
|------|------|
| 角色名称 | 莫宁 (Mornye) |
| 角色定位 | Healer（治疗） |
| 元素属性 | 熔融 (Fusion) |
| 协奏类型 | 红圈 (concerto_fusion) |
| 版本 | v3.0 |
| 源文件 | `src/core/combat/resonator/mornye.py` |

## 角色机制

莫宁拥有**双模式**战斗系统：

### 基准模式（常规形态）

- **静质量能** - 能量条，满时可重击进入广域观测模式
- 3段普攻积攒能量
- E技能（期望误差）
- 重击·位势转换：满能量时重击进入蝴蝶形态

### 广域观测模式（蝴蝶形态）

- **相对动能** - 能量条，满时可释放重击·反演
- 普攻和E技能为变身后的强化版
- E技能·分布式阵列
- 重击·反演：消耗相对动能

### 进阶轴核心循环

1. 3段普攻攒4格能量
2. 重击进入蝴蝶
3. E退出蝴蝶（获得5格能量）
4. 跳+普攻清空能量
5. 声骸技能合轴

## 技能状态检测

### 能量检测

| 检测项 | 值 | 说明 |
|--------|------|------|
| 静质量能 20% | 蓝色 `(63,119,250)` | 基准模式能量 |
| 静质量能 50% | 蓝色 | 基准模式能量 |
| 静质量能 80% | 蓝色 | 基准模式能量 |
| 相对动能 20% | 暖色系 | 广域观测模式能量 |
| 相对动能 50% | 暖色系 | 广域观测模式能量 |
| 相对动能 80% | 暖色系 | 广域观测模式能量 |

### 状态检测

| 检测项 | 逻辑 | 说明 |
|--------|------|------|
| 重击·位势转换 | AND | 满能量可变身（4个检测点白色） |
| 广域观测模式 | AND | 是否在蝴蝶形态（4个检测点白色） |
| 共鸣技能·分布式阵列 | AND | 蝴蝶E技能 |
| 重击·反演 | AND | 蝴蝶重击（5个检测点白色） |
| 声骸技能 Q | OR | 声骸就绪 |
| 共鸣解放 R | AND | 大招就绪 |
| 共鸣解放2 | AND | 谐振场内大招 |

## 连招片段

| 方法 | 描述 | 说明 |
|------|------|------|
| `a3()` | 3段普攻 | 攒能量，拆分了长等待 |
| `a2()` | 2段普攻 | 快速普攻 |
| `a3Ea()` | 3普攻+E+普攻 | E后接a防止E没好发呆 |
| `zaEja()` | 进阶轴核心 | 重击进蝴蝶+E退出+跳+普攻清能量 |
| `zE()` | 重击+E | 重击进蝴蝶+E退出 |
| `Eja()` | E+跳+普攻 | E退出+清能量 |
| `ja()` | 跳+普攻 | 清空能量 |
| `za()` | 重击+普攻 | 常规重击+打断防飞 |
| `E()` | E技能 | 仅E |
| `Q()` | 声骸技能 | 声骸释放 |
| `R()` | 共鸣解放 | 大招，等待3.08秒 |

## 连招决策逻辑 (`combo()`)

```
截图检测大招状态

入场: a3() 性价比3段普攻

1. 有R（协星调律）:
   ├─ E()
   ├─ R()
   └─ return

2. 再次截图检测:
   检查能量、E技能、R、Boss血量

3. 能量3格 且 有E 且 Boss未击败:
   ├─ zaEja() 进阶轴核心循环
   ├─ Q()
   └─ return

4. 通用处理:
   ├─ E() (无R时等待合轴)
   ├─ R() (有R时释放)
   ├─ 能量5格 → ja() 清能量
   └─ Q()

异常处理:
└─ StopError → jump() 打断蝴蝶变身防止飞出场外
```

## 设计特点

1. **蝴蝶飞出防护** - `combo()` 使用 try-except 捕获 `StopError`，调用 `jump()` 打断蝴蝶变身，防止击败 Boss 时蝴蝶飞出场外
2. **能量5格特殊处理** - 5格能量时改用 `ja()` 而非 `za()`，防止按键卡掉导致蝴蝶飞出
3. **性价比优先** - 入场先打 a3 性价比攻击，再判断是否有大招
4. **Boss 血量判断** - 进阶轴需要 Boss 血量 > 0.01 才执行

---

*最后更新: 2026-02-07*
