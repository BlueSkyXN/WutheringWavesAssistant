# 弗洛洛 (Phrolova) - 连招逻辑分析

## 基本信息

| 属性 | 值 |
|------|------|
| 角色名称 | 弗洛洛 (Phrolova) |
| 角色定位 | MainDPS（主输出） |
| 元素属性 | 熔融 (Fusion) |
| 协奏类型 | 红圈 (concerto_fusion) |
| 版本 | v2.5 |
| 源文件 | `src/core/combat/resonator/phrolova.py` |
| 实现状态 | ⚠️ 继承 GenericResonator，使用通用连招 |

## 角色机制

弗洛洛拥有 **4 格能量条**系统：

- 通过普攻、E 技能积攒能量
- 能量满时可释放强化攻击
- 重击（zRz）模式：重击 + 大招 + 重击

## 技能状态检测

`BasePhrolova` 中完整实现了技能检测：

### 能量检测

| 检测项 | 检测方式 | 说明 |
|--------|----------|------|
| 能量1格 | 检测第1段红色像素 `(107,97,250)` | 能量1格 |
| 能量2格 | 检测第2段红色像素 | 能量2格 |
| 能量3格 | 检测第3段红色像素 | 能量3格 |
| 能量4格 | 检测第4段红色像素 | 能量满 |

### 技能检测

| 检测项 | 图标颜色 | 说明 |
|--------|----------|------|
| 共鸣技能 E | 白色 `(255,255,255)` | E技能就绪 |
| 声骸技能 Q | 白色 `(255,255,255)` | 声骸就绪 |
| 共鸣解放 R | 白色 `(255,255,255)` | 大招就绪 |

## 当前实现状态

```python
class Phrolova(GenericResonator):
# class Phrolova(BasePhrolova):  # 原始设计，被注释掉
```

弗洛洛当前**继承自 `GenericResonator`** 而非 `BasePhrolova`，这意味着：

- 使用通用连招逻辑（简单的 E + Q + R + 普攻循环）
- **不使用** `BasePhrolova` 中精心设计的能量检测功能
- 注释中保留了完整的定制连招设计方案

## 被注释的连招设计

### COMBO_SEQ（训练场连段）

```
声骸 Qa3 → Ea → 等待 → a5 → Ea → 等待 → a5 → zRz
```

### 被注释的方法

| 方法 | 描述 | 说明 |
|------|------|------|
| `Ea()` | E+连续普攻 | 积攒一离火 |
| `E()` | 仅E | E技能 |
| `a2()` | 2段普攻 | 入场普攻 |
| `a3()` | 3段普攻 | 后续普攻 |
| `a()` | 单段普攻 | 单次普攻 |
| `z()` | 重击 | 按下0.7秒重击 |
| `az()` | 普攻+重击 | 普攻接重击 |
| `Rz()` | R+重击 | 大招接重击 |
| `zR()` | 重击+R | 重击接大招 |
| `Qa3()` | 梦魇摩托+3a | 声骸+普攻骑行 |
| `Q()` | 普通声骸 | 声骸释放 |
| `R()` | 共鸣解放 | 大招 |

### 唯一有效的特殊方法

```python
def quit_R(self):
    # 退出R状态，用于战斗结束移动前
    return [["R", 0.60, 0.30]]
```

这是唯一一个没有被注释的特殊方法，被 `CombatSystem.move_prepare()` 调用，用于在战斗结束移动前退出弗洛洛的大招状态。

## 设计分析

### 为什么使用 GenericResonator

代码注释中保留了完整的 `BasePhrolova` 定制连招方案，但最终选择了通用连招。可能的原因：

1. 弗洛洛的连招逻辑还在调试中
2. 通用连招已足够满足基本需求
3. 定制连招中的 zRz 模式在实战效果不佳（注释提到"被打断等情况，会长时间原地发呆"）

### 后续开发方向

建议基于 `BasePhrolova` 重新实现定制连招，利用已有的能量检测功能：

1. 检测能量格数决定是否释放重击
2. Ea 循环积攒能量
3. 能量满后 zR 或 Rz 打出大伤害
4. 避免使用 zRz 模式以防被打断

---

*最后更新: 2026-02-06*
