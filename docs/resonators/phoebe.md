# 菲比 (Phoebe) - 连招逻辑分析

## 基本信息

| 属性 | 值 |
|------|------|
| 角色名称 | 菲比 (Phoebe) |
| 角色定位 | Support（辅助） |
| 元素属性 | 衍射 (Spectro) |
| 协奏类型 | 黄圈 (concerto_spectro) |
| 版本 | v2.1 |
| 源文件 | `src/core/combat/resonator/phoebe.py` |
| 注册状态 | ⚠️ 未注册到 `resonator_map`，使用通用连招 |

## 角色机制

菲比是枪系辅助角色，拥有独特的**祈愿/福音**系统：

### 祈愿系统

- **祈愿能量上限 120 点**，24 秒自动涨满
- **未选择形态**时检测血条上方4个点的蓝色像素
- **选择形态后**检测位置右移

### 福音系统

- **福音能量上限 60 点**
- **赦罪状态**（输出模式）：进入时获得 60 点福音，强化重击消耗 15 点，可放 4 次
- **告解状态**（辅助模式）：进入时获得 60 点福音，强化重击消耗 30 点，加 5 层光噪，可放 2 次
- 福音能量条**黄色**为输出模式，**蓝白色**为辅助模式

### 操作方式

- 祈愿能量满、福音能量空时：
  - **长按普攻** → 进入赦罪状态（输出）
  - **长按E** → 进入告解状态（辅助）
- 输出方式：3 普攻 + 1 重击循环，消耗完福音后等祈愿涨满

## 技能状态检测

### 祈愿检测

| 检测项 | 逻辑 | 说明 |
|--------|------|------|
| 祈愿（基础形态） | AND | 未选择形态时4点检测 |
| 祈愿（切换形态后） | OR | 选择形态后单点检测 |

### 福音检测

| 检测项 | 逻辑 | 说明 |
|--------|------|------|
| 福音 15 | OR | 福音≥15点（3个检测点） |
| 福音 30 | OR | 福音≥30点（3个检测点） |

### 增强状态检测

| 检测项 | 逻辑 | 说明 |
|--------|------|------|
| 赦罪增强（输出） | AND | 福音条中间黄色 `(175,234,248)` |
| 告解增强（辅助） | AND | 福音条中间蓝白色 `(255,255,253)` |

### 技能检测

| 检测项 | 逻辑 | 说明 |
|--------|------|------|
| 共鸣技能 E1 | AND | E技能就绪 |
| 共鸣技能 E2 | AND | 第二段E技能 |
| 声骸技能 | OR | 声骸就绪 |
| 共鸣解放 R | OR | 大招就绪 |

## 连招片段

菲比提供了丰富的连招片段，但 `combo()` 方法未实现：

| 方法 | 描述 | 说明 |
|------|------|------|
| `a4()` | 4段普攻 | 完整4段普攻 |
| `a_intro()` | 变奏入场普攻 | 1.3秒覆盖变奏时间 |
| `a2_end()` | 后2段普攻 | 4a的后两段 |
| `z_musical_essence_3()` | 3格音律重击 | 消耗3格能量长按重击 |
| `E()` | E技能 | 两次冗余按E |
| `E3a()` | E+3段普攻 | E加一层风蚀，从第2段打 |
| `jEz()` | 跳E重击 | 空中E接3格音律重击 |
| `jEaaa()` | 跳+3普攻 | 跳接普攻（方法名有E但实际不含e按键） |
| `jEaaajaaa()` | 双循环 | jE+普攻+j+普攻循环 |
| `jaaa()` | 跳+3普攻 | 空中下落接普攻 |
| `Q()` | 声骸技能 | 声骸释放 |
| `R_aero_erosion()` | R风蚀 | 大招风蚀版 |
| `R_spectro_frazzle()` | R光噪 | 大招光噪版+普攻收尾 |

### 枪系特殊操作

COMBO_SEQ 中包含枪系通用操作：

- **瞄准加特林** - `G` 瞄准 + `a` 攻击的高频交替
- **瞄准无限戳** - `a` 攻击 + `G` 瞄准的慢节奏循环

## 连招决策逻辑 (`combo()`)

```python
def combo(self):
    # 赞菲队使用辅助菲比
    pass  # ← 未实现
```

⚠️ **combo() 为空实现**。菲比未注册到 `resonator_map`，实际使用时回退到 `GenericResonator` 通用连招。

## 设计现状

1. `BasePhoebe` 中完整实现了所有技能状态检测方法
2. `Phoebe` 中实现了丰富的连招片段方法
3. `COMBO_SEQ` 包含了完整的训练场连段（含枪系特殊操作）
4. **唯一缺失的是 `combo()` 决策逻辑**

## 后续开发方向

根据代码注释，菲比的连招逻辑应该围绕以下核心循环：

1. 等祈愿能量涨满
2. 消耗祈愿进入赦罪/告解状态，获得福音
3. 三普攻 + 一重击循环消耗福音
4. 福音空后等祈愿涨满，重新循环

---

*最后更新: 2026-02-06*
