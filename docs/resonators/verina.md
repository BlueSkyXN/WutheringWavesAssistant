# 维里奈 (Verina) - 连招逻辑分析

## 基本信息

| 属性 | 值 |
|------|------|
| 角色名称 | 维里奈 (Verina) |
| 角色定位 | Healer（治疗） |
| 元素属性 | 衍射 (Spectro) |
| 协奏类型 | 黄圈 (concerto_spectro) |
| 版本 | 常驻 |
| 源文件 | `src/core/combat/resonator/verina.py` |

## 角色机制

维里奈是经典治疗角色，核心循环简单高效：

- **aa + EQ** - 两段普攻接 E 和 Q 合轴
- **跳 + 3a** - 消耗能量的空中普攻
- **R** - 大招回复全队血量

### 能量系统

- 4 格能量条
- 普攻和技能积攒能量
- 有能量时跳 + 3a 消耗能量

## 技能状态检测

### 能量检测

| 检测项 | 检测方式 | 说明 |
|--------|----------|------|
| 能量1格 | 黄色像素 `(114,241,255)` | 第1段能量 |
| 能量2格 | 同上 | 第2段能量 |
| 能量3格 | 同上 | 第3段能量 |
| 能量4格 | 同上 | 第4段能量 |

### 技能检测

| 检测项 | 图标颜色 | 逻辑 | 说明 |
|--------|----------|------|------|
| 共鸣技能 E | 白色 `(255,255,255)` | OR | E技能就绪 |
| 声骸技能 Q | 白色 `(255,255,255)` | OR | 声骸就绪 |
| 共鸣解放 R | 白色/灰白 `(253,253,253)/(219,218,215)` | OR | 大招就绪 |

> **注意**：代码注释中 `_concerto_energy_checker` 的注释为"红圈"但实际用的是 `concerto_spectro()`（黄圈），这是注释笔误。

## 连招片段

| 方法 | 描述 | 说明 |
|------|------|------|
| `a3EQ()` | 3普攻+E+Q | 核心连招，3段普攻接EQ合轴，多打一个a防EQ没CD |
| `ja3()` | 跳+3段普攻 | 空中下落接3段普攻，拆分了长等待 |
| `a3()` | 3段普攻 | 普攻第3-5段的简化版 |
| `R()` | 共鸣解放 | 大招，等待2.63秒 |
| `EQR()` | E+Q+R | E+声骸+大招全部释放 |

## 连招决策逻辑 (`combo()`)

```
截图检测能量和大招状态

入场: a3EQ() 不管条件直接打aaEQ
      R() 大招不易识别，直接按（即使没好也按一下）

1. 有能量(>0):
   ├─ ja3() 跳接3段普攻消耗能量
   └─ return

2. 等待0.1秒再检测:
   └─ 能量>1 → ja3()
```

## 设计特点

1. **无条件释放** - a3EQ 和 R 不判断是否就绪直接释放，因为维里奈的技能识别不稳定
2. **大招直接按** - 注释说明"大招不易识别，直接按"，放弃智能判断改用暴力释放
3. **能量消耗** - 有能量就跳a消耗，不浪费能量
4. **延迟检测** - 第一次没能量时等 0.1 秒再检测，可能是 EQ 释放后才获得能量
5. **最简决策** - 维里奈的连招是所有定制角色中最简洁的

## 协奏注释笔误

`BaseVerina.__init__` 中注释 `# 协奏 左下血条旁红圈`，但实际使用的是 `ColorChecker.concerto_spectro()`（衍射黄圈）。这是一个注释笔误，不影响功能。

---

*最后更新: 2026-02-06*
