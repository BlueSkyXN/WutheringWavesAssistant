# 散华 (Sanhua) - 连招逻辑分析

## 基本信息

| 属性 | 值 |
|------|------|
| 角色名称 | 散华 (Sanhua) |
| 角色定位 | Support（辅助） |
| 元素属性 | 冷凝 (Glacio) |
| 协奏类型 | 蓝圈 (concerto_glacio) |
| 版本 | 常驻 |
| 源文件 | `src/core/combat/resonator/sanhua.py` |

## 角色机制

散华是经典的辅助角色，核心是快速释放 E + 重击（冰刺）+ 大招后切人：

- **Ez** - E 接重击打出冰刺
- **ERz** - E + R + 长按重击（大红莲华）
- **EQ** - E + 声骸合轴

## 技能状态检测

### 技能检测

| 检测项 | 图标颜色 | 逻辑 | 说明 |
|--------|----------|------|------|
| 共鸣技能 E | 白色 `(255,255,255)` | AND | E技能就绪 |
| 声骸技能 Q | 白色 `(255,255,255)` | OR | 声骸就绪 |
| 共鸣解放 R | 白色/橙色 `(255,193,142)/(255,214,181)` | OR | 大招就绪（支持多种颜色） |

## 连招片段

| 方法 | 描述 | 说明 |
|------|------|------|
| `a3()` | 3段普攻 | 变奏入场后随便打几下 |
| `z()` | 重击爆裂 | 长按0.915秒冰刺 |
| `Ez()` | E+重击 | E接重击冰刺 |
| `Rz()` | R+重击 | 大招接长按重击 |
| `ERz()` | E+R+重击 | 散华核心大红莲华连招 |
| `Q()` | 声骸技能 | 无常凶鹭等声骸 |
| `EQ()` | E+声骸 | E接声骸合轴 |

## 连招决策逻辑 (`combo()`)

```
入场: a3() 变奏下砸，打几下普攻

截图检测技能状态

1. 大红莲华 - 有R:
   ├─ 有E → ERz() (E+R+长按重击)
   └─ 无E → Rz() (R+长按重击)
   └─ return

2. 有E:
   ├─ 有声骸 → EQ() (E+声骸合轴)
   └─ 无声骸 → Ez() (E+重击冰刺)
   └─ return

3. 仅有声骸:
   └─ Q() 释放声骸
   └─ return

4. 兜底:
   └─ a3() 普攻
```

## 设计特点

1. **极简高效** - 散华连招简洁明了，优先级清晰
2. **R优先** - 有大招时优先打大红莲华（ERz），散华作为辅助核心输出
3. **E合轴** - 有声骸时EQ合轴，无声骸时Ez打冰刺
4. **长按重击** - ERz中的重击按下1.90秒（比训练场1.85稍长以确保释放）
5. **R颜色多样** - 大招图标支持白色和橙色两种状态检测

---

*最后更新: 2026-02-06*
