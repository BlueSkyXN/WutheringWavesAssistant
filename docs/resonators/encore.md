# 安可 (Encore) - 连招逻辑分析

## 基本信息

| 属性 | 值 |
|------|------|
| 角色名称 | 安可 (Encore) |
| 角色定位 | MainDPS（主输出） |
| 元素属性 | 熔融 (Fusion) |
| 协奏类型 | 红圈 (concerto_fusion) |
| 版本 | 常驻 |
| 源文件 | `src/core/combat/resonator/encore.py` |

## 角色机制

安可的核心机制是**黑咩大暴走**状态：

- 释放 R（共鸣解放）后进入黑咩大暴走状态
- 暴走状态下 E 技能变为强化版，连续 E+普攻+E 打满一套
- 能量满（1格）时可释放重击

## 技能状态检测

### 能量检测

| 检测项 | 检测方式 | 说明 |
|--------|----------|------|
| 能量满 | 检测能量条末端像素为红色 `(97,121,255)` | 满为1，未满为0 |

### 技能检测

| 检测项 | 图标颜色 | 逻辑 | 说明 |
|--------|----------|------|------|
| 共鸣技能 E | 白色 `(255,255,255)` | OR | E技能就绪 |
| 声骸技能 Q | 白色 `(255,255,255)` | OR | 声骸就绪 |
| 共鸣解放 R | 白色 `(255,255,255)` | OR | 大招就绪 |
| 黑咩大暴走 | 蓝紫色 `(73,81,181)` | AND | 暴走状态（检测能量条整体颜色变化） |

## 连招片段

| 方法 | 描述 | 说明 |
|------|------|------|
| `E()` | E技能 | 单独的E技能，等待1.9秒 |
| `Ea()` | E+连续普攻 | E接多段冗余普攻确保打出派生 |
| `a5()` | 5段普攻 | 完整5段普攻，拆分了长等待 |
| `a3()` | 3段快速普攻 | 固定频率连点，脱离空中状态 |
| `a2()` | 后2段普攻 | 普攻第4-5段 |
| `R()` | 共鸣解放 | 大招，等待2.63秒 |
| `Ea11E()` | 暴走模式连招 | E+11次普攻+E，暴走状态主要输出 |
| `z()` | 重击 | 长按0.7秒重击，等待3秒 |
| `Qa3()` | 梦魇摩托 | 声骸+3段普攻骑行 |
| `Q()` | 普通声骸 | 仅释放声骸 |

## 连招决策逻辑 (`combo()`)

```
入场: sleep(0.1) + a3() 打几个普攻（触发下落攻击）

截图检测所有技能状态

1. 黑咩大暴走状态:
   └─ Ea11E() 暴走连招
   └─ return

2. 能量满:
   └─ z() 重击
   └─ return

3. 大招就绪（空中放不出R）:
   ├─ R() 开大
   ├─ Ea11E() 暴走连招
   ├─ 检查能量满 → z() 重击
   └─ return

4. 有E:
   ├─ 66%概率 → Ea() E接普攻派生
   ├─ 34%概率 → E() 仅E
   └─ return

5. 有声骸:
   ├─ 随机梦魇/普通摩托
   └─ E()
   └─ return

6. 兜底 → a2() 普攻
   ├─ 大招图标二次检测（切人时先红一下导致颜色不匹配）
   │   ├─ 有R → R() + Ea11E()
   │   └─ 检查暴走 + 能量满 → z()
   ├─ 有声骸 → 随机摩托
   └─ 无声骸 → E()
```

## 设计特点

1. **暴走状态检测** - 通过能量条颜色变化识别黑咩大暴走状态
2. **大招二次检测** - 大招图标在切人时会先红一下导致首次检测失败，末尾增加二次检测
3. **入场a3** - 入场先打几个普攻触发下落攻击
4. **随机摩托** - 50%概率选择梦魇摩托或普通摩托
5. **重击判断** - 能量满时优先重击消耗能量
6. **Ea频率优化** - Ea()中拆分了长等待，增加普攻频率确保打出派生

---

*最后更新: 2026-02-06*
