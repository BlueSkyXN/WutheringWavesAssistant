# 今汐 (Jinhsi) - 连招逻辑分析

## 基本信息

| 属性 | 值 |
|------|------|
| 角色名称 | 今汐 (Jinhsi) |
| 角色定位 | MainDPS（主输出） |
| 元素属性 | 衍射 (Spectro) |
| 协奏类型 | 黄圈 (concerto_spectro) |
| 版本 | v1.1 |
| 源文件 | `src/core/combat/resonator/jinhsi.py` |

## 角色机制

今汐拥有最复杂的技能系统之一，有**四个阶段的E技能**：

- **E1 流光夕影** - 基础E，作为CD指标
- **E2 神霓飞芒** - 4段普攻后出现，进入乘岁凌霄状态
- **E3 逐天取月** - E2连招中出现的升龙
- **E4 惊龙破空** - 最终的强力喷射

### 连招路线

- **常规轴**: a4 → E1 → a3 → E2 → a2 → E3 → a → E4
- **速喷轴**: a4 → E2 → 闪避取消 → 跳跃 → 闪避 → E4
- **变奏速喷**: j+a+j+E（120帧限定技）

## 技能状态检测

### 技能检测

| 检测项 | 逻辑 | 说明 |
|--------|------|------|
| E1 流光夕影 | AND | 基础E，有图标说明E没有CD |
| E2 神霓飞芒 | AND | 4段普攻后出现 |
| E2 入场(黄色) | AND | 变奏入场时E2的黄色状态，容差50 |
| E3 逐天取月 | AND | 升龙技能 |
| E4 惊龙破空 | AND | 最终喷射 |
| E4 入场(黄色) | AND | 变奏入场时E4的黄色状态 |
| 声骸技能 Q | OR | 声骸就绪 |
| 共鸣解放 R | OR | 大招就绪 |

## 连招片段

| 方法 | 描述 | 说明 |
|------|------|------|
| `a4()` | 4段普攻打出E2 | 完整4段普攻+冗余a |
| `a2()` | 2段快速普攻 | 变奏速喷前置，触发下落攻击 |
| `E2_full_combo_E4()` | E2速喷直接到E4 | E2+闪避取消+跳跃+闪避→E4 |
| `E2_full_combo_E3E4()` | E2升龙再喷到E4 | E2+闪避取消+E3+普攻+E4 |
| `E2_intro_full_combo()` | 变奏速喷 | j+a+j+E（120帧限定技） |
| `E3_full_combo()` | E3起手套路 | 普攻+E+普攻+E+普攻+E |
| `E()` | 只打E | E4/E2使用，两次冗余按E |
| `Q()` | 声骸技能 | 声骸释放 |
| `R()` | 共鸣解放 | 大招，等待2秒 |

## 连招决策逻辑 (`combo()`)

```
截图检测所有技能状态
释放声骸 Q()

1. E2就绪 或 E2入场:
   ├─ sleep(0.5) + E() 释放E2
   ├─ sleep(0.5) + E() 再按一次确保释放
   └─ return

2. E4就绪 或 E4入场:
   ├─ E() 释放E4（喷射）
   ├─ R() 冗余尝试大招
   └─ return

3. 大招就绪:
   ├─ R() 开大
   ├─ E() 冗余尝试E
   └─ return

4. E3就绪:
   └─ E3_full_combo() 完整E3连招
   └─ return

5. E1就绪（E技能没CD）:
   ├─ a4() 4段普攻打出E2
   ├─ 检查E2:
   │   ├─ E2就绪 → boss血量低用E4速喷，否则随机E4或E3E4
   │   └─ E2未就绪 → E() + R()
   └─ return

6. 兜底（E技能CD中）:
   ├─ a4() 普攻
   ├─ 检查E4/E2 → E()
   └─ R()
```

## 设计特点

1. **四阶段E技能识别** - 需要识别四种不同的E技能图标状态
2. **入场颜色特殊处理** - E2和E4入场时图标为黄色而非白色
3. **速喷两种路线** - E4速喷（快但易被打断）和E3E4升龙再喷（稳但慢）
4. **Boss血量决策** - 血量低于20%时优先E4速喷，提高击杀效率
5. **冗余E操作** - 多处冗余按E，防止低帧率打不出技能
6. **变奏速喷** - COMBO_SEQ_2 中的 j+a+j+E 为120帧限定操作

---

*最后更新: 2026-02-06*
