# 长离 (Changli) - 连招逻辑分析

## 基本信息

| 属性 | 值 |
|------|------|
| 角色名称 | 长离 (Changli) |
| 角色定位 | SubDPS（副输出） |
| 元素属性 | 熔融 (Fusion) |
| 协奏类型 | 红圈 (concerto_fusion) |
| 版本 | v1.1 |
| 源文件 | `src/core/combat/resonator/changli.py` |

## 角色机制

长离的核心机制是**离火**系统（4格能量条）：

- 普攻可以积攒离火能量
- E技能（Ea）可以积攒离火能量，且E后接a产生一离火派生
- 4格离火时释放重击（z）可以打出**真炎·荒火**
- 真炎重击后接R+z可以打出大伤害

## 技能状态检测

### 能量检测

| 检测项 | 检测方式 | 说明 |
|--------|----------|------|
| 能量1格 | 检测血条上方第1段能量像素为红色 `(107,97,250)` | 离火1格 |
| 能量2格 | 检测第2段能量像素 | 离火2格 |
| 能量3格 | 检测第3段能量像素 | 离火3格 |
| 能量4格 | 检测第4段能量像素 | 离火满（可重击） |

### 技能检测

| 检测项 | 图标颜色 | 说明 |
|--------|----------|------|
| 共鸣技能 E | 白色 `(255,255,255)` | E技能就绪 |
| 声骸技能 Q | 白色 `(255,255,255)` | 声骸就绪 |
| 共鸣解放 R | 白色 `(255,255,255)` | 大招就绪 |

## 连招片段

| 方法 | 描述 | 说明 |
|------|------|------|
| `Ea()` | E+连续普攻 | E技能+冗余多段普攻，产生一离火 |
| `E()` | 仅E技能 | 单独的E技能 |
| `a2()` | 2段普攻 | 入场2段普攻 |
| `a3()` | 后3段普攻 | 普攻第3~5段，接转圈 |
| `a()` | 单段普攻 | 一次普攻 |
| `z()` | 重击 | 按下0.7秒的重击 |
| `az()` | 普攻+重击 | 一段普攻接重击 |
| `Rz()` | R+重击 | 大招接重击 |
| `zR()` | 重击+R | 重击接大招（穿插普攻） |
| `Qa3()` | 声骸+3段普攻 | 梦魇摩托骑行+普攻 |
| `Q()` | 声骸技能 | 普通摩托释放 |
| `R()` | 共鸣解放 | 仅大招 |

## 连招决策逻辑 (`combo()`)

```
入场: sleep(0.1) + a2() 打两个普攻（触发心眼冲）
截图检测能量和技能状态

1. 4格离火:
   ├─ z() 重击
   ├─ a2() 等待后摇
   ├─ 再次确认4格 → 再 z()
   │   ├─ 消耗成功(非4格) → Rz() 大招重击
   │   └─ 仍为4格 → 重击失败，不做操作直接 return
   └─ 非4格 → E()
   └─ return

2. 3格离火 且 有E:
   ├─ Ea() 打满4格
   ├─ 检测: 4格 → z() 重击
   │   └─ 有R → Rz()
   ├─ 非4格但有R → Rz()
   └─ return

3. 低离火(<3格) 且 有R:
   └─ Rz() 直接开大+重击
   └─ return

4. 兜底:
   ├─ 有E → E() 合轴
   ├─ 无E → a3() 普攻 + 检查4格重击
   ├─ 声骸最后放 → Q()
```

## 设计特点

1. **离火能量管理** - 核心目标是攒满4格离火后释放重击
2. **双重确认** - 重击后会再次检查离火数，防止空中重击变成下落攻击
3. **入场a2** - 入场先打两段普攻触发心眼冲，增加离火效率
4. **声骸最后放** - 声骸技能放在最后用于合轴，而非最先释放
5. **E优先级** - 3格离火时优先用E填满，低离火有R时直接开大

---

*最后更新: 2026-02-06*
